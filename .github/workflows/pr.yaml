name: Run go build and Scanning by Trivy vulnerability in IaC mode
on:
  pull_request:
    branches:
      - main
jobs:
  pr:
    name: Run go build and Scanning by Trivy vulnerability in IaC mode
    runs-on: ubuntu-latest
    steps:
    - name: Set up Go
      uses: actions/setup-go@v6
      with:
        go-version: "1.23"
    - name: Check out code into the Go module directory
      uses: actions/checkout@v4
    - name: Get dependencies
      run: go mod download
    - name: Build
      run: go build -v app/main.go
    - name: Run Trivy vulnerability scanner in IaC mode
      uses: aquasecurity/trivy-action@0.31.0
      with:
        scan-type: 'config'
        hide-progress: false
        format: 'table'
        exit-code: '1'
        ignore-unfixed: true
        severity: 'CRITICAL,HIGH'
